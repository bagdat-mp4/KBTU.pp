import psycopg2  # PostgreSQL –¥–µ—Ä–µ–∫“õ–æ—Ä—ã–º–µ–Ω –∂“±–º—ã—Å —ñ—Å—Ç–µ—É–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω psycopg2 –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞—Å—ã–Ω –∏–º–ø–æ—Ä—Ç—Ç–∞—É
import csv       # CSV —Ñ–∞–π–ª–¥–∞—Ä—ã–º–µ–Ω –∂“±–º—ã—Å —ñ—Å—Ç–µ—É–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω csv –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞—Å—ã–Ω –∏–º–ø–æ—Ä—Ç—Ç–∞—É
import os        # –û–ø–µ—Ä–∞—Ü–∏—è–ª—ã“õ –∂“Ø–π–µ–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏—è–ª–∞—Ä “Ø—à—ñ–Ω os –∫—ñ—Ç–∞–ø—Ö–∞–Ω–∞—Å—ã–Ω –∏–º–ø–æ—Ä—Ç—Ç–∞—É

# PostgreSQL-“ì–∞ “õ–æ—Å—ã–ª—É “Ø—à—ñ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–¥—ñ –æ—Ä–Ω–∞—Ç—É
conn = psycopg2.connect(  # PostgreSQL –¥–µ—Ä–µ–∫“õ–æ—Ä—ã–Ω–∞ “õ–æ—Å—ã–ª—É–¥—ã –±–∞—Å—Ç–∞—É
    database="postgres",  # “ö–æ—Å—ã–ª–∞—Ç—ã–Ω –¥–µ—Ä–µ–∫“õ–æ—Ä–¥—ã“£ –∞—Ç—ã
    user="postgres",      # –î–µ—Ä–µ–∫“õ–æ—Ä“ì–∞ –∫—ñ—Ä—É “Ø—à—ñ–Ω –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∞—Ç—ã
    password="1111",      # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã“£ “õ“±–ø–∏—è—Å”©–∑—ñ
    host="localhost",     # –î–µ—Ä–µ–∫“õ–æ—Ä —Å–µ—Ä–≤–µ—Ä—ñ –æ—Ä–Ω–∞–ª–∞—Å“õ–∞–Ω —Ö–æ—Å—Ç (–∫–æ–º–ø—å—é—Ç–µ—Ä)
    port="5432"           # –î–µ—Ä–µ–∫“õ–æ—Ä —Å–µ—Ä–≤–µ—Ä—ñ —Ç—ã“£–¥–∞–π—Ç—ã–Ω –ø–æ—Ä—Ç –Ω”©–º—ñ—Ä—ñ
)

cur = conn.cursor()  # –î–µ—Ä–µ–∫“õ–æ—Ä–¥–∞ SQL —Å“±—Ä–∞—É–ª–∞—Ä—ã–Ω –æ—Ä—ã–Ω–¥–∞—É “Ø—à—ñ–Ω –∫—É—Ä—Å–æ—Ä –Ω—ã—Å–∞–Ω—ã–Ω –∂–∞—Å–∞—É

# contacts –∫–µ—Å—Ç–µ—Å—ñ–Ω—ñ“£ –±–∞—Ä –µ–∫–µ–Ω—ñ–Ω —Ç–µ–∫—Å–µ—Ä—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã
def check_table_exists(): # 'check_table_exists' –∞—Ç—Ç—ã —Ñ—É–Ω–∫—Ü–∏—è–Ω—ã –∞–Ω—ã“õ—Ç–∞—É
    try: # –ú“Ø–º–∫—ñ–Ω –±–æ–ª–∞—Ç—ã–Ω “õ–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É “Ø—à—ñ–Ω try –±–ª–æ–≥—ã–Ω –±–∞—Å—Ç–∞—É
        # 'public.contacts' –∫–µ—Å—Ç–µ—Å—ñ–Ω—ñ“£ –±–∞—Ä-–∂–æ“ì—ã–Ω —Ç–µ–∫—Å–µ—Ä–µ—Ç—ñ–Ω SQL —Å“±—Ä–∞—É—ã–Ω –æ—Ä—ã–Ω–¥–∞—É
        cur.execute("SELECT to_regclass('public.contacts');")
        # –°“±—Ä–∞—É –Ω”ô—Ç–∏–∂–µ—Å—ñ–Ω –∞–ª—É
        result = cur.fetchone()[0]
        if result is None: # –ï–≥–µ—Ä –∫–µ—Å—Ç–µ –∂–æ“õ –±–æ–ª—Å–∞
            print("–ö–µ—Å—Ç–µ –∂–æ“õ, –æ–Ω—ã –∂–∞—Å–∞—É –∫–µ—Ä–µ–∫.") # –•–∞–±–∞—Ä–ª–∞–º–∞ —à—ã“ì–∞—Ä—É
            # –ï–≥–µ—Ä –∫–µ—Å—Ç–µ –∂–æ“õ –±–æ–ª—Å–∞, –æ–Ω—ã –∂–∞—Å–∞—É –∫–µ—Ä–µ–∫
            cur.execute(""" # –ö”©–ø –∂–æ–ª–¥—ã SQL —Å“±—Ä–∞—É—ã–Ω –±–∞—Å—Ç–∞—É
                CREATE TABLE contacts ( # 'contacts' –∞—Ç—Ç—ã –∂–∞“£–∞ –∫–µ—Å—Ç–µ –∂–∞—Å–∞—É
                    id SERIAL PRIMARY KEY, # –ê–≤—Ç–æ–º–∞—Ç—Ç—ã —Ç“Ø—Ä–¥–µ ”©—Å–µ—Ç—ñ–Ω –±—ñ—Ä–µ–≥–µ–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
                    name VARCHAR(100),     # –ê—Ç—ã —Å–∞“õ—Ç–∞–ª–∞—Ç—ã–Ω –±–∞“ì–∞–Ω
                    phone VARCHAR(20)      # –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ —Å–∞“õ—Ç–∞–ª–∞—Ç—ã–Ω –±–∞“ì–∞–Ω
                );
            """) # SQL —Å“±—Ä–∞—É—ã–Ω –∞—è“õ—Ç–∞—É
            conn.commit() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –¥–µ—Ä–µ–∫“õ–æ—Ä–¥–∞ —Å–∞“õ—Ç–∞—É
            print("–ö–µ—Å—Ç–µ –∂–∞—Å–∞–ª–¥—ã.") # –°”ô—Ç—Ç—ñ –∂–∞—Å–∞–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        else: # –ï–≥–µ—Ä –∫–µ—Å—Ç–µ –±–∞—Ä –±–æ–ª—Å–∞
            print("–ö–µ—Å—Ç–µ –±–∞—Ä.") # –ë–∞—Ä –µ–∫–µ–Ω–¥—ñ–≥—ñ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
    except Exception as e: # –ï–≥–µ—Ä “õ–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        conn.rollback() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –±–æ–ª–¥—ã—Ä–º–∞—É

# “Æ–ª–≥—ñ (pattern) –±–æ–π—ã–Ω—à–∞ –±–∞—Ä–ª—ã“õ –∂–∞–∑–±–∞–ª–∞—Ä–¥—ã “õ–∞–π—Ç–∞—Ä–∞—Ç—ã–Ω —Ñ—É–Ω–∫—Ü–∏—è
def search_contacts(pattern): # 'search_contacts' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É ('pattern' –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–º–µ–Ω)
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        # –ê—Ç –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω –±–µ—Ä—ñ–ª–≥–µ–Ω “Ø–ª–≥—ñ–≥–µ —Å”ô–π–∫–µ—Å –∫–µ–ª–µ—Ç—ñ–Ω –∂–∞–∑–±–∞–ª–∞—Ä–¥—ã —ñ–∑–¥–µ—É (ILIKE - —Ä–µ–≥–∏—Å—Ç—Ä–≥–µ —Ç”ô—É–µ–ª—Å—ñ–∑)
        cur.execute("SELECT * FROM contacts WHERE name ILIKE %s OR phone ILIKE %s", (f'%{pattern}%', f'%{pattern}%'))
        rows = cur.fetchall() # –ë–∞—Ä–ª—ã“õ —Ç–∞–±—ã–ª“ì–∞–Ω –∂–æ–ª–¥–∞—Ä–¥—ã –∞–ª—É
        if rows: # –ï–≥–µ—Ä –∂–æ–ª–¥–∞—Ä —Ç–∞–±—ã–ª—Å–∞
            for row in rows: # ”ò—Ä–±—ñ—Ä –∂–æ–ª–¥—ã –∏—Ç–µ—Ä–∞—Ü–∏—è–ª–∞—É
                print(row) # –ñ–æ–ª–¥—ã —ç–∫—Ä–∞–Ω“ì–∞ —à—ã“ì–∞—Ä—É
        else: # –ï–≥–µ—Ä –µ—à—Ç–µ“£–µ —Ç–∞–±—ã–ª–º–∞—Å–∞
            print("–ú”ô–ª—ñ–º–µ—Ç —Ç–∞–±—ã–ª–º–∞–¥—ã.") # –•–∞–±–∞—Ä–ª–∞–º–∞ —à—ã“ì–∞—Ä—É
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ê—Ç—ã –º–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω—ã –±–æ–π—ã–Ω—à–∞ –∂–∞“£–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –µ–Ω–≥—ñ–∑—É–≥–µ –∞—Ä–Ω–∞–ª“ì–∞–Ω –ø—Ä–æ—Ü–µ–¥—É—Ä–∞, –µ–≥–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã –±–∞—Ä –±–æ–ª—Å–∞, —Ç–µ–ª–µ—Ñ–æ–Ω—ã–Ω –∂–∞“£–∞—Ä—Ç–∞–¥—ã
def insert_or_update_user(user_name, user_phone): # 'insert_or_update_user' –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        # –ë–µ—Ä—ñ–ª–≥–µ–Ω –∞—Ç –±–æ–π—ã–Ω—à–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã“£ –±–∞—Ä-–∂–æ“ì—ã–Ω —Ç–µ–∫—Å–µ—Ä—É
        cur.execute("SELECT id FROM contacts WHERE name = %s", (user_name,))
        result = cur.fetchone() # –ù”ô—Ç–∏–∂–µ–Ω—ñ –∞–ª—É (—Ç–∞–±—ã–ª—Å–∞ –∫–æ—Ä—Ç–µ–∂, –∂–æ“õ –±–æ–ª—Å–∞ None)
        if result: # –ï–≥–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã —Ç–∞–±—ã–ª—Å–∞
            # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã“£ —Ç–µ–ª–µ—Ñ–æ–Ω—ã–Ω –∂–∞“£–∞—Ä—Ç—É
            cur.execute("UPDATE contacts SET phone = %s WHERE name = %s", (user_phone, user_name))
            print(f"User {user_name} phone updated.") # –ñ–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        else: # –ï–≥–µ—Ä –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã —Ç–∞–±—ã–ª–º–∞—Å–∞
            # –ñ–∞“£–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã –∫–µ—Å—Ç–µ–≥–µ “õ–æ—Å—É
            cur.execute("INSERT INTO contacts (name, phone) VALUES (%s, %s)", (user_name, user_phone))
            print(f"User {user_name} added.") # “ö–æ—Å—ã–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        conn.commit() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ (“õ–æ—Å—É –Ω–µ–º–µ—Å–µ –∂–∞“£–∞—Ä—Ç—É) —Å–∞“õ—Ç–∞—É
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        conn.rollback() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –±–æ–ª–¥—ã—Ä–º–∞—É

# –ê—Ç—ã –º–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω—ã —Ç—ñ–∑—ñ–º—ñ –±–æ–π—ã–Ω—à–∞ –∫”©–ø—Ç–µ–≥–µ–Ω –∂–∞“£–∞ –ø–∞–π–¥–∞–ª–∞–Ω—É—à—ã–ª–∞—Ä–¥—ã –µ–Ω–≥—ñ–∑—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã, —Ç–µ–ª–µ—Ñ–æ–Ω –¥“±—Ä—ã—Å—Ç—ã“ì—ã–Ω —Ç–µ–∫—Å–µ—Ä–µ–¥—ñ
def insert_multiple_users(users_list): # 'insert_multiple_users' –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É ('users_list' —Ç—ñ–∑—ñ–º—ñ–Ω “õ–∞–±—ã–ª–¥–∞–π–¥—ã)
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        for user_data in users_list: # –¢—ñ–∑—ñ–º–¥–µ–≥—ñ ”ô—Ä–±—ñ—Ä —ç–ª–µ–º–µ–Ω—Ç ('user_data') “Ø—à—ñ–Ω —Ü–∏–∫–ª
            name_part, phone_part = user_data.split(',') # –≠–ª–µ–º–µ–Ω—Ç—Ç—ñ “Ø—Ç—ñ—Ä –∞—Ä“õ—ã–ª—ã –∞—Ç –ø–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω“ì–∞ –±”©–ª—É
            # –¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ —Ç–µ–∫ —Å–∞–Ω–¥–∞—Ä–¥–∞–Ω —Ç“±—Ä–º–∞—Å–∞ –ù–ï–ú–ï–°–ï “±–∑—ã–Ω–¥—ã“ì—ã 10-–Ω–∞–Ω –∞–∑ –±–æ–ª—Å–∞ (“õ–∞—Ä–∞–ø–∞–π—ã–º —Ç–µ–∫—Å–µ—Ä—É)
            if not phone_part.isdigit() or len(phone_part) < 10:
                print(f"“ö–∞—Ç–µ –¥–µ—Ä–µ–∫: {user_data} –¥“±—Ä—ã—Å –µ–º–µ—Å —Ç–µ–ª–µ—Ñ–æ–Ω.") # “ö–∞—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
            else: # –ï–≥–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω —Ñ–æ—Ä–º–∞—Ç—ã –¥“±—Ä—ã—Å –±–æ–ª—Å–∞
                 # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ–æ—Å—É –Ω–µ–º–µ—Å–µ –∂–∞“£–∞—Ä—Ç—É “Ø—à—ñ–Ω –∞–ª–¥—ã“£“ì—ã –ø—Ä–æ—Ü–µ–¥—É—Ä–∞–Ω—ã —à–∞“õ—ã—Ä—É
                insert_or_update_user(name_part, phone_part)
        print("–ë–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä “õ–æ—Å—ã–ª–¥—ã.") # –ë–∞—Ä–ª—ã“õ –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ ”©“£–¥–µ—É ”ô—Ä–µ–∫–µ—Ç—ñ –∞—è“õ—Ç–∞–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ü–∞–≥–∏–Ω–∞—Ü–∏—è“ì–∞ –∞—Ä–Ω–∞–ª“ì–∞–Ω —Ñ—É–Ω–∫—Ü–∏—è (limit –∂”ô–Ω–µ offset)
def get_contacts_paginated(limit_size, offset_size): # 'get_contacts_paginated' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        # –ë–µ–ª–≥—ñ–ª—ñ –±—ñ—Ä —Å–∞–Ω–Ω–∞–Ω ('limit_size') –∞—Å–ø–∞–π—Ç—ã–Ω –∂”ô–Ω–µ –±–µ–ª–≥—ñ–ª—ñ –±—ñ—Ä –æ—Ä—ã–Ω–Ω–∞–Ω ('offset_size') –±–∞—Å—Ç–∞–ª–∞—Ç—ã–Ω –∫–æ–Ω—Ç–∞–∫—Ç—ñ–ª–µ—Ä–¥—ñ —Ç–∞“£–¥–∞—É
        cur.execute("SELECT * FROM contacts LIMIT %s OFFSET %s", (limit_size, offset_size))
        rows = cur.fetchall() # –¢–∞–±—ã–ª“ì–∞–Ω –∂–æ–ª–¥–∞—Ä–¥—ã –∞–ª—É
        if rows: # –ï–≥–µ—Ä –∂–æ–ª–¥–∞—Ä —Ç–∞–±—ã–ª—Å–∞
            for row in rows: # ”ò—Ä–±—ñ—Ä –∂–æ–ª–¥—ã –∏—Ç–µ—Ä–∞—Ü–∏—è–ª–∞—É
                print(row) # –ñ–æ–ª–¥—ã —à—ã“ì–∞—Ä—É
        else: # –ï–≥–µ—Ä –µ—à—Ç–µ“£–µ —Ç–∞–±—ã–ª–º–∞—Å–∞
            print("–ú”ô–ª—ñ–º–µ—Ç —Ç–∞–±—ã–ª–º–∞–¥—ã.") # –•–∞–±–∞—Ä–ª–∞–º–∞ —à—ã“ì–∞—Ä—É
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã –∞—Ç—ã –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω—ã –±–æ–π—ã–Ω—à–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ ”©—à—ñ—Ä—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã
def delete_contact_by_user_or_phone(user_name=None, user_phone=None): # 'delete_contact_by_user_or_phone' –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É (–º—ñ–Ω–¥–µ—Ç—Ç—ñ –µ–º–µ—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–ª–µ—Ä–º–µ–Ω)
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        if user_name: # –ï–≥–µ—Ä 'user_name' –±–µ—Ä—ñ–ª—Å–µ
            # –ê—Ç—ã –±–æ–π—ã–Ω—à–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ ”©—à—ñ—Ä—É
            cur.execute("DELETE FROM contacts WHERE name = %s", (user_name,))
        elif user_phone: # –ù–µ–º–µ—Å–µ, –µ–≥–µ—Ä 'user_phone' –±–µ—Ä—ñ–ª—Å–µ
            # –¢–µ–ª–µ—Ñ–æ–Ω—ã –±–æ–π—ã–Ω—à–∞ –∫–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ ”©—à—ñ—Ä—É
            cur.execute("DELETE FROM contacts WHERE phone = %s", (user_phone,))
        conn.commit() # ”®—à—ñ—Ä—É –æ–ø–µ—Ä–∞—Ü–∏—è—Å—ã–Ω —Å–∞“õ—Ç–∞—É
        print("‚ùå –ö–æ–Ω—Ç–∞–∫—Ç ”©—à—ñ—Ä—ñ–ª–¥—ñ.") # ”®—à—ñ—Ä—ñ–ª–≥–µ–Ω—ñ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        conn.rollback() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –±–æ–ª–¥—ã—Ä–º–∞—É

# CSV —Ñ–∞–π–ª—ã–Ω–∞–Ω –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –µ–Ω–≥—ñ–∑—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (–∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω)
def insert_from_csv(file_path): # 'insert_from_csv' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        with open(file_path, 'r') as f: # –§–∞–π–ª–¥—ã –æ“õ—É“ì–∞ –∞—à—É
            reader = csv.reader(f) # CSV –æ“õ—É “õ“±—Ä–∞–ª—ã–Ω –∂–∞—Å–∞—É
            for row in reader: # –§–∞–π–ª–¥–∞“ì—ã ”ô—Ä–±—ñ—Ä –∂–æ–ª “Ø—à—ñ–Ω
                if len(row) == 2: # –ï–≥–µ—Ä –∂–æ–ª–¥–∞ 2 —ç–ª–µ–º–µ–Ω—Ç –±–æ–ª—Å–∞
                    # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ–æ—Å—É –Ω–µ–º–µ—Å–µ –∂–∞“£–∞—Ä—Ç—É “Ø—à—ñ–Ω 'insert_or_update_user' –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω —à–∞“õ—ã—Ä—É
                    insert_or_update_user(row[0], row[1])
                else: # –ï–≥–µ—Ä —Ñ–æ—Ä–º–∞—Ç –¥“±—Ä—ã—Å –±–æ–ª–º–∞—Å–∞
                    print(f"–ï—Å–∫–µ—Ä—Ç—É: {row} –∂–æ–ª—ã –¥“±—Ä—ã—Å –µ–º–µ—Å —Ñ–æ—Ä–º–∞—Ç—Ç–∞.") # –ï—Å–∫–µ—Ä—Ç—É —à—ã“ì–∞—Ä—É
            print("üì• CSV –¥–µ—Ä–µ–∫—Ç–µ—Ä—ñ “õ–æ—Å—ã–ª–¥—ã.") # –ê—è“õ—Ç–∞–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# “ö–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É –∞—Ä“õ—ã–ª—ã –¥–µ—Ä–µ–∫—Ç–µ—Ä–¥—ñ –µ–Ω–≥—ñ–∑—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (–∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω)
def insert_from_input(): # 'insert_from_input' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        name = input("–ê—Ç—ã“£—ã–∑–¥—ã –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑: ") # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–¥–∞–Ω –∞—Ç—Ç—ã —Å“±—Ä–∞—É
        phone = input("–¢–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ: ") # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–¥–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–¥—ã —Å“±—Ä–∞—É
        # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–Ω—ã “õ–æ—Å—É –Ω–µ–º–µ—Å–µ –∂–∞“£–∞—Ä—Ç—É “Ø—à—ñ–Ω 'insert_or_update_user' –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω —à–∞“õ—ã—Ä—É
        insert_or_update_user(name, phone)
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ö–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ –∂–∞“£–∞—Ä—Ç—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (ID –±–æ–π—ã–Ω—à–∞)
def update_contact(): # 'update_contact' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        contact_id = input("“ö–∞–π ID –∂–∞“£–∞—Ä—Ç–∞—Å—ã“£? ") # –ñ–∞“£–∞—Ä—Ç—ã–ª–∞—Ç—ã–Ω ID —Å“±—Ä–∞—É
        new_name = input("–ñ–∞“£–∞ –∞—Ç—ã: ") # –ñ–∞“£–∞ –∞—Ç—Ç—ã —Å“±—Ä–∞—É
        new_phone = input("–ñ–∞“£–∞ —Ç–µ–ª–µ—Ñ–æ–Ω: ") # –ñ–∞“£–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–¥—ã —Å“±—Ä–∞—É
        # –ë–µ—Ä—ñ–ª–≥–µ–Ω ID –±–æ–π—ã–Ω—à–∞ –∞—Ç –ø–µ–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–¥—ã –∂–∞“£–∞—Ä—Ç—É
        cur.execute("UPDATE contacts SET name = %s, phone = %s WHERE id = %s", (new_name, new_phone, contact_id))
        conn.commit() # –ñ–∞“£–∞—Ä—Ç—É–¥—ã —Å–∞“õ—Ç–∞—É
        print("‚ôªÔ∏è –ö–æ–Ω—Ç–∞–∫—Ç –∂–∞“£–∞—Ä—Ç—ã–ª–¥—ã.") # –°”ô—Ç—Ç—ñ –∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω—ã —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞
        conn.rollback() # ”®–∑–≥–µ—Ä—ñ—Å—Ç–µ—Ä–¥—ñ –±–æ–ª–¥—ã—Ä–º–∞—É

# –§–∏–ª—å—Ç—Ä–º–µ–Ω —Å“±—Ä–∞–Ω—ã—Å –∂–∞—Å–∞—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã (–±“±—Ä—ã–Ω“ì—ã–¥–∞–π)
def query_with_filter(): # 'query_with_filter' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    try: # “ö–∞—Ç–µ–ª–µ—Ä–¥—ñ “±—Å—Ç–∞—É –±–ª–æ–≥—ã
        keyword = input("–ê—Ç—ã –Ω–µ –Ω–æ–º–µ—Ä –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ: ") # –Ü–∑–¥–µ—É –∫—ñ–ª—Ç —Å”©–∑—ñ–Ω —Å“±—Ä–∞—É
        # –ê—Ç –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É (ILIKE - —Ä–µ–≥–∏—Å—Ç—Ä–≥–µ —Ç”ô—É–µ–ª—Å—ñ–∑)
        cur.execute("SELECT * FROM contacts WHERE name ILIKE %s OR phone ILIKE %s", (f'%{keyword}%', f'%{keyword}%'))
        rows = cur.fetchall() # –ë–∞—Ä–ª—ã“õ —Ç–∞–±—ã–ª“ì–∞–Ω –∂–æ–ª–¥–∞—Ä–¥—ã –∞–ª—É
        if rows: # –ï–≥–µ—Ä –∂–æ–ª–¥–∞—Ä —Ç–∞–±—ã–ª—Å–∞
            for row in rows: # ”ò—Ä–±—ñ—Ä –∂–æ–ª–¥—ã –∏—Ç–µ—Ä–∞—Ü–∏—è–ª–∞—É
                print(row) # –ñ–æ–ª–¥—ã —à—ã“ì–∞—Ä—É
        else: # –ï–≥–µ—Ä –µ—à—Ç–µ“£–µ —Ç–∞–±—ã–ª–º–∞—Å–∞
            print("–ú”ô–ª—ñ–º–µ—Ç —Ç–∞–±—ã–ª–º–∞–¥—ã.") # –•–∞–±–∞—Ä–ª–∞–º–∞ —à—ã“ì–∞—Ä—É
    except Exception as e: # “ö–∞—Ç–µ –±–æ–ª—Å–∞
        print(f"“ö–∞—Ç–µ –æ—Ä—ã–Ω –∞–ª–¥—ã: {e}") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ù–µ–≥—ñ–∑–≥—ñ –º–µ–Ω—é (–∂–∞“£–∞—Ä—Ç—ã–ª“ì–∞–Ω)
def menu(): # 'menu' —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω –∞–Ω—ã“õ—Ç–∞—É
    run = True # –¶–∏–∫–ª–¥—ñ“£ –∂“±–º—ã—Å—ã–Ω –±–∞—Å“õ–∞—Ä–∞—Ç—ã–Ω –∞–π–Ω—ã–º–∞–ª—ã
    check_table_exists()  # –ú–µ–Ω—é –∞–ª–¥—ã–Ω–¥–∞ –∫–µ—Å—Ç–µ–Ω—ñ —Ç–µ–∫—Å–µ—Ä—É

    while run: # 'run' True –±–æ–ª“ì–∞–Ω—à–∞ —Ü–∏–∫–ª –∂–∞–ª“ì–∞—Å–∞–¥—ã
        print("\nüì± PHONEBOOK MENU:") # –ú–µ–Ω—é —Ç–∞“õ—ã—Ä—ã–±—ã
        print("1 - Search by pattern")      # 1-—à—ñ –æ–ø—Ü–∏—è: “Æ–ª–≥—ñ –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É
        print("2 - Insert from CSV")        # 2-—à—ñ –æ–ø—Ü–∏—è: CSV-–¥–∞–Ω –µ–Ω–≥—ñ–∑—É
        print("3 - Insert from input")      # 3-—à—ñ –æ–ø—Ü–∏—è: “ö–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É
        print("4 - Update contact")         # 4-—à—ñ –æ–ø—Ü–∏—è: –ö–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ –∂–∞“£–∞—Ä—Ç—É (ID –±–æ–π—ã–Ω—à–∞)
        print("5 - Query with filter")      # 5-—à—ñ –æ–ø—Ü–∏—è: –§–∏–ª—å—Ç—Ä–º–µ–Ω —Å“±—Ä–∞–Ω—ã—Å
        print("6 - Delete contact")         # 6-—à—ñ –æ–ø—Ü–∏—è: –ö–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ ”©—à—ñ—Ä—É (–∞—Ç/—Ç–µ–ª–µ—Ñ–æ–Ω –±–æ–π—ã–Ω—à–∞)
        print("7 - Exit")                   # 7-—à—ñ –æ–ø—Ü–∏—è: –®—ã“ì—É

        # –ü–∞–π–¥–∞–ª–∞–Ω—É—à—ã–¥–∞–Ω —Ç–∞“£–¥–∞—É —Å“±—Ä–∞—É
        choice = input("–¢–∞“£–¥–∞“£—ã–∑ (1‚Äì7): ") # –¢–∞“£–¥–∞—É–¥—ã –∞–ª—É

        if choice == '1': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '1' –±–æ–ª—Å–∞
            pattern = input("–Ü–∑–¥–µ—É “Ø—à—ñ–Ω “Ø–ª–≥—ñ –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑: ") # “Æ–ª–≥—ñ–Ω—ñ —Å“±—Ä–∞—É
            search_contacts(pattern) # “Æ–ª–≥—ñ –±–æ–π—ã–Ω—à–∞ —ñ–∑–¥–µ—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É
        elif choice == '2': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '2' –±–æ–ª—Å–∞
            file_path = input("CSV —Ñ–∞–π–ª–¥—ã“£ —Ç–æ–ª—ã“õ –∂–æ–ª—ã–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑: ") # CSV —Ñ–∞–π–ª –∂–æ–ª—ã–Ω —Å“±—Ä–∞—É
            insert_from_csv(file_path) # CSV-–¥–∞–Ω –µ–Ω–≥—ñ–∑—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É
        elif choice == '3': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '3' –±–æ–ª—Å–∞
            insert_from_input() # “ö–æ–ª–º–µ–Ω –µ–Ω–≥—ñ–∑—É —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É
        elif choice == '4': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '4' –±–æ–ª—Å–∞
            update_contact() # –ö–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ –∂–∞“£–∞—Ä—Ç—É (ID –±–æ–π—ã–Ω—à–∞) —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É
        elif choice == '5': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '5' –±–æ–ª—Å–∞
            query_with_filter() # –§–∏–ª—å—Ç—Ä–º–µ–Ω —Å“±—Ä–∞–Ω—ã—Å —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É
        elif choice == '6': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '6' –±–æ–ª—Å–∞
            user_name_or_phone = input("”®—à—ñ—Ä—ñ–ª–µ—Ç—ñ–Ω –∫–æ–Ω—Ç–∞–∫—Ç—ñ–Ω—ñ“£ –∞—Ç—ã –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω –Ω”©–º—ñ—Ä—ñ–Ω –µ–Ω–≥—ñ–∑—ñ“£—ñ–∑: ") # –ê—Ç –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω–¥—ã —Å“±—Ä–∞—É
            # –ê—Ç –Ω–µ–º–µ—Å–µ —Ç–µ–ª–µ—Ñ–æ–Ω –±–æ–π—ã–Ω—à–∞ ”©—à—ñ—Ä—É –ø—Ä–æ—Ü–µ–¥—É—Ä–∞—Å—ã–Ω —à–∞“õ—ã—Ä—É (–±–µ—Ä—ñ–ª–≥–µ–Ω –º”ô–Ω–¥—ñ 'user_name' —Ä–µ—Ç—ñ–Ω–¥–µ –∂—ñ–±–µ—Ä–µ–¥—ñ)
            delete_contact_by_user_or_phone(user_name=user_name_or_phone)
        elif choice == '7': # –ï–≥–µ—Ä —Ç–∞“£–¥–∞—É '7' –±–æ–ª—Å–∞
            run = False # –¶–∏–∫–ª–¥—ã —Ç–æ“õ—Ç–∞—Ç—É “Ø—à—ñ–Ω 'run' –∞–π–Ω—ã–º–∞–ª—ã—Å—ã–Ω 'False' –µ—Ç—É
        else: # –ï–≥–µ—Ä –∂–∞—Ä–∞–º—Å—ã–∑ —Ç–∞“£–¥–∞—É –±–æ–ª—Å–∞
            print("‚ùó “ö–∞—Ç–µ —Ç–∞“£–¥–∞—É.") # “ö–∞—Ç–µ —Ç—É—Ä–∞–ª—ã —Ö–∞–±–∞—Ä–ª–∞–º–∞

# –ë–∞“ì–¥–∞—Ä–ª–∞–º–∞–Ω—ã —ñ—Å–∫–µ “õ–æ—Å—É
menu()  # –ù–µ–≥—ñ–∑–≥—ñ –º–µ–Ω—é —Ñ—É–Ω–∫—Ü–∏—è—Å—ã–Ω —à–∞“õ—ã—Ä—É

# –ö—É—Ä—Å–æ—Ä –º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å –æ–±—ä–µ–∫—Ç—ñ–ª–µ—Ä—ñ–Ω –∂–∞–±—É
cur.close() # –ö—É—Ä—Å–æ—Ä–¥—ã –∂–∞–±—É
conn.close() # –î–µ—Ä–µ–∫“õ–æ—Ä–º–µ–Ω –±–∞–π–ª–∞–Ω—ã—Å—Ç—ã –∂–∞–±—É